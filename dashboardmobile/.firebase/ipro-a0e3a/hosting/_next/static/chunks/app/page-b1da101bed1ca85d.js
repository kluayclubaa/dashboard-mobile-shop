(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{964:(e,a,t)=>{"use strict";let s;t.r(a),t.d(a,{default:()=>j});var r=t(5155);t(9137);var l=t(2115),i=t(3915),d=t(6203),n=t(5317);s=(0,i.Dk)().length?(0,i.Dk)()[0]:(0,i.Wp)({apiKey:"AIzaSyCHJCdKoWaOeM29Z8ubWWyULAXrvbTjb5s",authDomain:"ipro-a0e3a.firebaseapp.com",projectId:"ipro-a0e3a",storageBucket:"ipro-a0e3a.firebasestorage.app",messagingSenderId:"816977961038",appId:"1:816977961038:web:c2b1a6e7be95766462631f",measurementId:"G-GGBX7T7WGL"});let c=(0,n.aU)(s),o=(0,d.xI)(s),x=e=>{let{className:a,variant:t,...s}=e,l={default:"bg-blue-600 text-white hover:bg-blue-700",destructive:"bg-red-500 text-destructive-foreground hover:bg-red-600",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-gray-200 text-secondary-foreground hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",ghost:"hover:bg-accent hover:text-accent-foreground"},i="outline"===t?l.outline:"ghost"===t?l.ghost:"secondary"===t?l.secondary:"destructive"===t?l.destructive:l.default;return(0,r.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background"," ").concat(i," ").concat(a," px-4 py-2"),...s})},h=e=>(0,r.jsx)("svg",{...e,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,r.jsx)("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),m=e=>(0,r.jsxs)("svg",{...e,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M16.5 9.4a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"}),(0,r.jsx)("path",{d:"M12 15.4a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"}),(0,r.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"}),(0,r.jsx)("path",{d:"m3.3 7 8.7 5 8.7-5"}),(0,r.jsx)("path",{d:"M12 22V12"})]}),g=e=>(0,r.jsxs)("svg",{...e,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"m12 19-7-7 7-7"}),(0,r.jsx)("path",{d:"M19 12H5"})]}),u=e=>(0,r.jsxs)("svg",{...e,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})," ",(0,r.jsx)("path",{d:"m15 5 4 4"})]}),p=e=>(0,r.jsxs)("svg",{...e,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M3 6h18"}),(0,r.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),(0,r.jsx)("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),(0,r.jsx)("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),(0,r.jsx)("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]}),y=e=>(0,r.jsxs)("svg",{...e,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,r.jsx)("line",{x1:"12",x2:"12",y1:"8",y2:"16"}),(0,r.jsx)("line",{x1:"8",x2:"16",y1:"12",y2:"12"})]});function j(){let[e,a]=(0,l.useState)(null),[t,s]=(0,l.useState)(""),[i,j]=(0,l.useState)(""),[v,f]=(0,l.useState)(!0),[k,w]=(0,l.useState)([]),[N,S]=(0,l.useState)([]),[_,C]=(0,l.useState)([]),[I,q]=(0,l.useState)("main"),[L,M]=(0,l.useState)(null),[E,B]=(0,l.useState)({type:null}),[A,D]=(0,l.useState)("");(0,l.useEffect)(()=>{let e=(0,d.hg)(o,e=>{a(e),f(!1)});return()=>e()},[]),(0,l.useEffect)(()=>{if(!e){w([]),S([]),C([]);return}let a=[(0,n.aQ)((0,n.rJ)(c,"branches"),e=>w(e.docs.map(e=>({id:e.id,...e.data()})))),(0,n.aQ)((0,n.rJ)(c,"stock"),e=>S(e.docs.map(e=>({id:e.id,...e.data()})))),(0,n.aQ)((0,n.P)((0,n.rJ)(c,"repairJobs"),(0,n.My)("createdAt","desc")),e=>C(e.docs.map(e=>({id:e.id,...e.data()}))))];return()=>a.forEach(e=>e())},[e]);let{totalRevenue:J,totalRepairs:W,stockSummary:H,selectedBranchStock:O,selectedBranchJobs:P}=(0,l.useMemo)(()=>{let e=_.reduce((e,a)=>e+(a.price||0),0),a=_.length,t=N.reduce((e,a)=>(e[a.name]=(e[a.name]||0)+a.quantity,e),{});return{totalRevenue:e,totalRepairs:a,stockSummary:t,selectedBranchStock:N.filter(e=>e.branchId===(null==L?void 0:L.id)),selectedBranchJobs:_.filter(e=>e.branchId===(null==L?void 0:L.id))}},[_,N,L]),U=async()=>{if("1234"===t){j(""),f(!0);try{await (0,d.zK)(o)}catch(e){console.error("Firebase Sign-In Error:",e),j("การเชื่อมต่อล้มเหลว กรุณาลองใหม่"),f(!1)}}else j("รหัสผ่านไม่ถูกต้อง")},Q=async()=>{await (0,d.CI)(o),q("main"),M(null)},T=(e,a)=>{B({type:e,data:a}),D("")},Z=()=>{B({type:null}),D("")},z=async e=>{e&&(await (0,n.gS)((0,n.rJ)(c,"branches"),{name:e}),Z())},G=async(e,a,t)=>{e&&!(a<=0)&&L&&(t?await (0,n.mZ)((0,n.H9)(c,"stock",t),{quantity:a}):await (0,n.gS)((0,n.rJ)(c,"stock"),{branchId:L.id,name:e,quantity:parseInt(a.toString(),10)}),Z())},K=async e=>{e&&(await (0,n.kd)((0,n.H9)(c,"stock",e)),Z())},R=async(e,a,t,s)=>{if(!L||!e)return D("กรุณากรอกข้อมูลให้ครบถ้วน");let r=new Map;null==s||s.itemsUsed.forEach(e=>r.set(e.stockId,e.quantity));let l=new Map;t.forEach(e=>l.set(e.stockId,e.quantity));let i=new Set([...r.keys(),...l.keys()]);try{await (0,n.c4)(c,async d=>{let o=await Promise.all(Array.from(i).map(async e=>{var a,t;let s=(0,n.H9)(c,"stock",e),i=await d.get(s);if(!i.exists())throw Error("ไม่พบสินค้า ID: ".concat(e));let o=i.data().quantity,x=null!=(a=r.get(e))?a:0,h=null!=(t=l.get(e))?t:0,m=x-h;if(m<0&&o<-m)throw Error("สินค้า '".concat(i.data().name,"' ไม่เพียงพอ"));return{ref:s,newQty:o+m}}));s?d.update((0,n.H9)(c,"repairJobs",s.id),{description:e,price:a,itemsUsed:t}):d.set((0,n.H9)((0,n.rJ)(c,"repairJobs")),{branchId:L.id,description:e,price:a,itemsUsed:t,createdAt:new Date().toISOString()}),o.forEach(e=>{let{ref:a,newQty:t}=e;return d.update(a,{quantity:t})})}),Z()}catch(e){console.error("Transaction failed:",e),D(e.message)}},V=async e=>{if(e)try{await (0,n.c4)(c,async a=>{let t=e.itemsUsed.map(async e=>{let t=(0,n.H9)(c,"stock",e.stockId),s=await a.get(t);return s.exists()?{ref:t,newQuantity:s.data().quantity+e.quantity}:(console.warn("Stock item ".concat(e.name," (ID: ").concat(e.stockId,") not found for restoration.")),null)}),s=(await Promise.all(t)).filter(Boolean),r=(0,n.H9)(c,"repairJobs",e.id);a.delete(r),s.forEach(e=>{e&&a.update(e.ref,{quantity:e.newQuantity})})}),Z()}catch(e){console.error("Delete transaction failed:",e),D(e.message)}};return v?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,r.jsx)("p",{children:"กำลังโหลด..."})}):e?(0,r.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between h-16 px-6 border-b bg-white dark:bg-gray-900 dark:border-gray-800 sticky top-0 z-10",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"I-PRO Dashboard"}),(0,r.jsx)(x,{variant:"outline",onClick:Q,children:"ออกจากระบบ"})]}),(0,r.jsxs)("main",{className:"flex-1 p-4 md:p-6",children:["main"===I&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,r.jsx)("h2",{className:"text-3xl font-semibold",children:"ภาพรวมทั้งหมด"}),(0,r.jsxs)(x,{onClick:()=>T("add_branch"),children:[(0,r.jsx)(y,{className:"w-5 h-5 mr-2"}),"เพิ่มสาขาใหม่"]})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,r.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow dark:bg-gray-900",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-500 dark:text-gray-400",children:"รายได้รวม"}),(0,r.jsxs)("p",{className:"text-4xl font-bold",children:["฿",J.toLocaleString()]})]}),(0,r.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow dark:bg-gray-900",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-500 dark:text-gray-400",children:"จำนวนงานซ่อม"}),(0,r.jsx)("p",{className:"text-4xl font-bold",children:W.toLocaleString()})]}),(0,r.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow dark:bg-gray-900 col-span-1 md:col-span-2",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-500 dark:text-gray-400",children:"สต็อกคงคลัง (ตามชื่อสินค้า)"}),(0,r.jsx)("div",{className:"mt-2 text-sm space-y-1 overflow-y-auto max-h-24 pr-2",children:Object.keys(H).length>0?Object.entries(H).map(e=>{let[a,t]=e;return(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:a})," ",(0,r.jsxs)("span",{children:[t.toLocaleString()," ชิ้น"]})]},a)}):(0,r.jsx)("p",{className:"text-gray-400",children:"ไม่มีสินค้าในสต็อก"})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:"สาขาทั้งหมด"}),k.length>0?(0,r.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:k.map(e=>(0,r.jsxs)("div",{onClick:()=>{M(e),q("branch_details")},className:"p-6 bg-white rounded-lg shadow cursor-pointer hover:shadow-lg transition-shadow dark:bg-gray-900",children:[(0,r.jsx)("h4",{className:"text-xl font-bold",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"คลิกเพื่อดูรายละเอียด"})]},e.id))}):(0,r.jsx)("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:'ยังไม่มีสาขา... คลิก "เพิ่มสาขาใหม่" เพื่อเริ่มต้น'})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:"รายการซ่อมล่าสุด"}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden dark:bg-gray-900",children:_.length>0?(0,r.jsx)("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:_.slice(0,5).map(e=>{var a,t;return(0,r.jsx)("li",{className:"p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold",children:e.description}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["สาขา:"," ",(null==(a=k.find(a=>a.id===e.branchId))?void 0:a.name)||"N/A"]})]}),(0,r.jsxs)("p",{className:"font-semibold whitespace-nowrap",children:["฿",(null==(t=e.price)?void 0:t.toLocaleString())||0]})]})},e.id)})}):(0,r.jsx)("p",{className:"text-center text-gray-500 py-8",children:"ยังไม่มีรายการซ่อม"})})]})]})]}),"branch_details"===I&&L&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(x,{variant:"ghost",onClick:()=>q("main"),className:"flex items-center gap-2",children:[(0,r.jsx)(g,{className:"w-5 h-5"})," กลับไปหน้าหลัก"]}),(0,r.jsxs)("h2",{className:"text-3xl font-semibold",children:["รายละเอียดสาขา: ",L.name]}),(0,r.jsxs)("div",{className:"flex gap-4 flex-wrap",children:[(0,r.jsxs)(x,{onClick:()=>T("add_repair"),children:[(0,r.jsx)(h,{className:"w-5 h-5 mr-2"})," เพิ่มรายการซ่อม"]}),(0,r.jsxs)(x,{variant:"secondary",onClick:()=>q("stock_management"),children:[(0,r.jsx)(m,{className:"w-5 h-5 mr-2"})," จัดการ Stock"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:"รายการซ่อม"}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden dark:bg-gray-900",children:P.length>0?(0,r.jsx)("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:P.map(e=>{var a;return(0,r.jsx)("li",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:(0,r.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-semibold",children:[e.description," - ราคา:"," ",(null==(a=e.price)?void 0:a.toLocaleString())||0," บาท"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ใช้อุปกรณ์:"," ",e.itemsUsed.map(e=>"".concat(e.name," (").concat(e.quantity," ชิ้น)")).join(", ")||"ไม่มี"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["วันที่: ",new Date(e.createdAt).toLocaleString()]})]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-shrink-0",children:[(0,r.jsx)(x,{variant:"ghost",onClick:()=>T("edit_repair",e),children:(0,r.jsx)(u,{className:"w-4 h-4"})}),(0,r.jsx)(x,{variant:"ghost",onClick:()=>T("delete_repair",e),children:(0,r.jsx)(p,{className:"w-4 h-4 text-red-500"})})]})]})},e.id)})}):(0,r.jsx)("p",{className:"text-center text-gray-500 py-8",children:"ยังไม่มีรายการซ่อม"})})]})]}),"stock_management"===I&&L&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(x,{variant:"ghost",onClick:()=>q("branch_details"),className:"flex items-center gap-2",children:[(0,r.jsx)(g,{className:"w-5 h-5"})," กลับไปหน้ารายละเอียดสาขา"]}),(0,r.jsxs)("h2",{className:"text-3xl font-semibold",children:["จัดการสต็อก: ",L.name]}),(0,r.jsx)("div",{className:"flex gap-4 flex-wrap",children:(0,r.jsxs)(x,{onClick:()=>T("add_stock"),children:[(0,r.jsx)(y,{className:"w-5 h-5 mr-2"}),"เพิ่มของเข้าสต็อก"]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow overflow-x-auto dark:bg-gray-900",children:O.length>0?(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,r.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ชื่อสินค้า"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"จำนวนคงเหลือ"}),(0,r.jsx)("th",{scope:"col",className:"relative px-6 py-3",children:(0,r.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-900 dark:divide-gray-700",children:O.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap font-medium",children:e.name}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:e.quantity}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,r.jsxs)(x,{variant:"ghost",onClick:()=>T("edit_stock",e),children:[(0,r.jsx)(u,{className:"w-4 h-4"})," แก้ไข"]}),(0,r.jsxs)(x,{variant:"ghost",className:"text-red-600 hover:text-red-700",onClick:()=>T("delete_stock",e),children:[(0,r.jsx)(p,{className:"w-4 h-4"})," ลบ"]})]})})]},e.id))})]}):(0,r.jsx)("p",{className:"text-center text-gray-500 py-8",children:"ยังไม่มีของในสต็อก"})})]})]}),E.type&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4 relative",children:[(0,r.jsx)(x,{variant:"ghost",onClick:Z,className:"absolute top-2 right-2 !p-2 h-auto",children:"X"}),(0,r.jsx)(b,{modalState:E,closeModal:Z,setModalError:D,modalError:A,selectedBranch:L,handleAddBranch:z,handleAddOrUpdateStockItem:G,handleDeleteStockItem:K,selectedBranchStock:O,handleAddOrUpdateRepairJob:R,handleDeleteRepairJob:V})]})})]}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,r.jsxs)("div",{className:"w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md dark:bg-gray-800",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"I-PRO Dashboard"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"กรุณาใส่รหัสผ่านเพื่อเข้าสู่ระบบ"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("input",{type:"password",value:t,onChange:e=>s(e.target.value),onKeyPress:e=>"Enter"===e.key&&U(),placeholder:"รหัสผ่าน",className:"w-full px-4 py-2 text-gray-900 bg-gray-100 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white dark:border-gray-600"}),i&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:i}),(0,r.jsx)(x,{onClick:U,className:"w-full",children:"เข้าสู่ระบบ"})]})]})})}let b=e=>{var a,t,s,i,d;let{modalState:n,closeModal:c,modalError:o,setModalError:h,selectedBranch:m,handleAddBranch:g,handleAddOrUpdateStockItem:u,handleDeleteStockItem:p,selectedBranchStock:y,handleAddOrUpdateRepairJob:j,handleDeleteRepairJob:b}=e,[v,f]=(0,l.useState)((null==(a=n.data)?void 0:a.name)||""),[k,w]=(0,l.useState)((null==(t=n.data)?void 0:t.quantity)||1),[N,S]=(0,l.useState)((null==(s=n.data)?void 0:s.description)||""),[_,C]=(0,l.useState)((null==(i=n.data)?void 0:i.price)||0),[I,q]=(0,l.useState)(((null==(d=n.data)?void 0:d.itemsUsed)||[]).map(e=>({...e,quantity:Number(e.quantity)||0}))),L=(e,a)=>{var t,s;let r=isNaN(a)?0:a,l=null!=(s=null==(t=I.find(a=>a.stockId===e.id))?void 0:t.quantity)?s:0,i=Math.max(0,Math.min(r,e.quantity+l));q(a=>0===i?a.filter(a=>a.stockId!==e.id):[...a.filter(a=>a.stockId!==e.id),{stockId:e.id,name:e.name,quantity:i}])},M=e=>{switch(e.preventDefault(),h(""),n.type){case"add_branch":g(v);break;case"add_stock":u(v,k);break;case"edit_stock":u(n.data.name,k,n.data.id);break;case"add_repair":j(N,_,I);break;case"edit_repair":j(N,_,I,n.data)}};switch(n.type){case"add_branch":case"add_stock":case"edit_stock":return(0,r.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,r.jsxs)("h3",{className:"text-xl font-bold",children:["add_branch"===n.type&&"เพิ่มสาขาใหม่","add_stock"===n.type&&"เพิ่มของเข้าสต็อก","edit_stock"===n.type&&"แก้ไขสต็อก: ".concat(n.data.name)]}),"edit_stock"!==n.type&&(0,r.jsx)("input",{value:v,onChange:e=>f(e.target.value),type:"text",placeholder:"add_branch"===n.type?"ชื่อสาขา":"ชื่อสินค้า",required:!0,className:"w-full input-style"}),"add_branch"!==n.type&&(0,r.jsx)("input",{value:k,onChange:e=>w(Number(e.target.value)),type:"number",placeholder:"จำนวน",min:"1",required:!0,className:"w-full input-style"}),o&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:o}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,r.jsx)(x,{type:"button",variant:"ghost",onClick:c,children:"ยกเลิก"}),(0,r.jsx)(x,{type:"submit",children:"บันทึก"})]})]});case"delete_stock":case"delete_repair":return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-red-500",children:"ยืนยันการลบ"}),(0,r.jsxs)("p",{children:['คุณแน่ใจหรือไม่ว่าต้องการลบ "',n.data.name||n.data.description,'"? การกระทำนี้ไม่สามารถย้อนกลับได้']}),"delete_repair"===n.type&&(0,r.jsx)("p",{className:"text-sm text-yellow-500",children:"การลบรายการซ่อมจะทำการคืนสต็อกสินค้าที่ใช้ไปกลับเข้าระบบ"}),o&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:o}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,r.jsx)(x,{type:"button",variant:"ghost",onClick:c,children:"ยกเลิก"}),(0,r.jsx)(x,{type:"button",variant:"destructive",onClick:()=>"delete_stock"===n.type?p(n.data.id):b(n.data),children:"ยืนยันการลบ"})]})]});case"add_repair":case"edit_repair":return(0,r.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-xl font-bold",children:"add_repair"===n.type?"เพิ่มรายการซ่อม":"แก้ไขรายการซ่อม"}),(0,r.jsx)("input",{value:N,onChange:e=>S(e.target.value),type:"text",placeholder:"ซ่อมอะไร (เช่น เปลี่ยนหน้าจอ)",required:!0,className:"w-full input-style"}),(0,r.jsx)("input",{value:_,onChange:e=>C(Number(e.target.value)),type:"number",placeholder:"ราคาซ่อม",min:"0",required:!0,className:"w-full input-style"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"อุปกรณ์ที่ใช้:"}),(0,r.jsx)("div",{className:"max-h-48 overflow-y-auto border rounded-md p-2 space-y-2",children:y.length>0?y.map(e=>{var a;let t=I.find(a=>a.stockId===e.id),s=e.quantity+((null==t?void 0:t.quantity)||0);return(0,r.jsxs)("div",{className:"grid grid-cols-3 items-center gap-2",children:[(0,r.jsxs)("label",{htmlFor:"item-".concat(e.id),className:"col-span-2 truncate",children:[e.name," (มี ",s,")"]}),(0,r.jsx)("input",{id:"item-".concat(e.id),type:"number",min:0,max:s,step:1,value:null!=(a=null==t?void 0:t.quantity)?a:0,onChange:a=>L(e,a.currentTarget.valueAsNumber),onBlur:a=>{""===a.currentTarget.value&&(a.currentTarget.value="0",L(e,0))},className:"w-full input-style text-center"})]},e.id)}):(0,r.jsx)("p",{className:"text-gray-400 text-sm p-2",children:"ไม่มีของในสต็อกให้เลือก"})})]}),o&&(0,r.jsx)("p",{className:"text-sm text-red-500 bg-red-100 dark:bg-red-900/50 p-2 rounded",children:o}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,r.jsx)(x,{type:"button",variant:"ghost",onClick:c,children:"ยกเลิก"}),(0,r.jsx)(x,{type:"submit",children:"บันทึก"})]})]});default:return null}};j.displayName="IProDashboard"},9256:(e,a,t)=>{Promise.resolve().then(t.bind(t,964))}},e=>{var a=a=>e(e.s=a);e.O(0,[992,163,780,441,684,358],()=>a(9256)),_N_E=e.O()}]);